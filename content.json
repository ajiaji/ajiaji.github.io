{"meta":{"title":"赵松哲的个人博客","subtitle":"赵松哲的个人博客","description":"运维中的常见问题及处理方案","author":"赵松哲","url":"http://blog.zsongzhe.site","root":"/"},"pages":[{"title":"内容简介","date":"2020-08-21T03:24:37.000Z","updated":"2020-09-09T16:08:40.436Z","comments":true,"path":"about/index.html","permalink":"http://blog.zsongzhe.site/about/index.html","excerpt":"","text":"个人整理的收付费常见问题及处理方案"},{"title":"文章分类","date":"2020-08-25T02:47:54.000Z","updated":"2020-09-09T16:08:40.436Z","comments":true,"path":"categories/index.html","permalink":"http://blog.zsongzhe.site/categories/index.html","excerpt":"","text":""},{"title":"文章分类","date":"2020-08-25T02:50:15.000Z","updated":"2020-09-09T16:08:40.437Z","comments":true,"path":"tags/index.html","permalink":"http://blog.zsongzhe.site/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"使用gitee+hexo+picgo搭建个人博客","slug":"使用gitee-hexo-picgo搭建个人博客","date":"2020-09-09T16:26:35.000Z","updated":"2020-09-09T16:40:01.352Z","comments":true,"path":"2020/09/10/使用gitee-hexo-picgo搭建个人博客/","link":"","permalink":"http://blog.zsongzhe.site/2020/09/10/使用gitee-hexo-picgo搭建个人博客/","excerpt":"","text":"遇到的一些问题： Q1：git上传下载后，hexo server启动之后无法访问，打开页面后报错： Unhandled rejection TypeError: D:\\GitRepo\\hexo\\themes\\hueman\\layout\\index.ejs:1 1| &lt;%- partial(‘common/archive’) %&gt; D:\\GitRepo\\hexo\\themes\\hueman\\layout\\common\\archive.ejs:19 17| 18| &lt;% } %&gt; 19| &lt;%- partial(‘summary’, { post: post }) %&gt; 20| &lt;% if (postCount == page.posts.length || postCount % 2 == 0) { %&gt; 21| 22| &lt;% } %&gt; D:\\GitRepo\\hexo\\themes\\hueman\\layout\\common\\summary.ejs:3 1| 2| 3| &lt;% if (theme.customize.thumbnail === true) { %&gt; 4| &lt;%- partial(‘common/thumbnail’, { counter: true }) %&gt; 5| &lt;% } %&gt; 6| Cannot read property ‘thumbnail’ of undefined at eval (eval at compile (D:\\GitRepo\\hexo\\node_modules\\ejs\\lib\\ejs.js:618:12), :11:28) at returnedFn (D:\\GitRepo\\hexo\\node_modules\\ejs\\lib\\ejs.js:653:17) at Theme._View.View._compiledSync (D:\\GitRepo\\hexo\\node_modules\\hexo\\lib\\theme\\view.js:121:22) at Theme._View.View.View.renderSync (D:\\GitRepo\\hexo\\node_modules\\hexo\\lib\\theme\\view.js:49:23) at Object.partial (D:\\GitRepo\\hexo\\node_modules\\hexo\\lib\\plugins\\helper\\partial.js:38:15) at eval (eval at compile (D:\\GitRepo\\hexo\\node_modules\\ejs\\lib\\ejs.js:618:12), :45:17) at Model._Query.Query.Query.forEach (D:\\GitRepo\\hexo\\node_modules\\warehouse\\lib\\query.js:42:5) at eval (eval at compile (D:\\GitRepo\\hexo\\node_modules\\ejs\\lib\\ejs.js:618:12), :10:19) at returnedFn (D:\\GitRepo\\hexo\\node_modules\\ejs\\lib\\ejs.js:653:17) at Theme._View.View._compiledSync (D:\\GitRepo\\hexo\\node_modules\\hexo\\lib\\theme\\view.js:121:22) at Theme._View.View.View.renderSync (D:\\GitRepo\\hexo\\node_modules\\hexo\\lib\\theme\\view.js:49:23) at Object.partial (D:\\GitRepo\\hexo\\node_modules\\hexo\\lib\\plugins\\helper\\partial.js:38:15) at eval (eval at compile (D:\\GitRepo\\hexo\\node_modules\\ejs\\lib\\ejs.js:618:12), :7:17) at returnedFn (D:\\GitRepo\\hexo\\node_modules\\ejs\\lib\\ejs.js:653:17) at Theme._View.View._compiled (D:\\GitRepo\\hexo\\node_modules\\hexo\\lib\\theme\\view.js:125:48) at Theme._View.View.View.render (D:\\GitRepo\\hexo\\node_modules\\hexo\\lib\\theme\\view.js:30:15) at D:\\GitRepo\\hexo\\node_modules\\hexo\\lib\\hexo\\index.js:394:29 at tryCatcher (D:\\GitRepo\\hexo\\node_modules\\bluebird\\js\\release\\util.js:16:23) at D:\\GitRepo\\hexo\\node_modules\\bluebird\\js\\release\\method.js:15:34 at RouteStream._read (D:\\GitRepo\\hexo\\node_modules\\hexo\\lib\\hexo\\router.js:134:3) at RouteStream.Readable.read (stream_readable.js:467:10) at resume (_stream_readable.js:981:12) INFO Farewell 受链接 中的主题错误的启发，发现是路径【themes\\hueman】下的 【.gitignore】配置是 1_config.yml 这个配置导致上传到git中的没有主题的配置文件，导致主题加载失败，把这个文件加上之后就可以正常启动访问了。","categories":[{"name":"HEXO","slug":"HEXO","permalink":"http://blog.zsongzhe.site/categories/HEXO/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"http://blog.zsongzhe.site/tags/hexo/"},{"name":"个人博客","slug":"个人博客","permalink":"http://blog.zsongzhe.site/tags/个人博客/"},{"name":"picgo","slug":"picgo","permalink":"http://blog.zsongzhe.site/tags/picgo/"},{"name":"gitee","slug":"gitee","permalink":"http://blog.zsongzhe.site/tags/gitee/"},{"name":"hueman","slug":"hueman","permalink":"http://blog.zsongzhe.site/tags/hueman/"}]},{"title":"对账","slug":"对账","date":"2020-09-09T09:16:01.000Z","updated":"2020-09-09T16:08:40.435Z","comments":true,"path":"2020/09/09/对账/","link":"","permalink":"http://blog.zsongzhe.site/2020/09/09/对账/","excerpt":"","text":"核销 目前支票、汇票、现金、刷卡四种缴费方式需要收付费系统核销 刷卡流水的核销结果进sffposmatch,非刷卡流水的核销结果进sffmatch（matchtype核销类别：1.现金 2.汇票 3、支票 4、资金划转） 刷卡核销 刷卡缴费的时候，刷卡成功完成缴付费后，刷卡信息进sffposinfo（刷卡信息），保单生成； T+1后银行提供上一日的流水清单（包括刷卡、非刷卡，银行是按照账户提供流水清单的）； 财务人员将银行提供的流水信息导入收付费系统，收付费系统将其处理后的最终结果存入sffcommbankflow（银行流水信息）表中； 收付费通过【自动对账处理】 自动任务进行刷卡流水的核销（关联关系为sffposinfo.searchno=sffcommbankflow.sourcebankflowno且sffposinfo.posamount=sffcommbankflow.amount） 核销成功后的sffcommbankflow中的matchflag=5（初始为0），sffposinfo的matchflag=1（初始为0）； Q1：刷卡流水与银行流水的对应关系（即sffposinfo怎么关联查到对应的银行流水sffcommbankflowno） ​ sffposinfo.searchno=sffcommbankflow.sourcebankflowno 一般可以用这个查到刷卡信息对应的银行流水信息，如果使用刷卡信息缴费的投保单无法生成保单的时候，可以通过这个关联关系查到对应的银行流水，使用该银行流水用于重新出单的缴费或者再次缴费（删除原来投保单的缴费信息后，再重新缴费） 另外，如果刷卡信息无法核销，则可以通过该关联关系查询，确认是否是因为银行流水信息错误或者缺失，导致刷卡信息无法核销（sffposmatch无信息） 其他流水的核销 支票（sffchequeinfo）、汇票（sffdraftinfo）、现金（sffcashinfo）因其使用不频繁，核销信息没有像刷卡流水一样单独拆出： sffmatch：核销汇总信息在sffmatch中，单独存核销信息，无需要核销的流水信息及银行流水信息； sffmatchdetail：核销信息与需要核销的流水的关联关系存在sffmatchdetail中，核销类别根据matchtype的值进行区分：1.现金 2.汇票 3、支票 4、资金划转；需要核销的流水通过flowno和流水信息表进行关联（sffchequeinfo.chequeflowno、sffcashinfo.cashflowno、sffdraftinfo.draftflowno），并通过核销流水号（matchno）和sffmatch关联; sffbankmatchdetail：关联核销信息及银行流水的信息存在sffbankmatchdetail中，核销流水号（matchno）与sffcommbankflow.bankflowno在此表中关联，其中sffbankmatchdetail.matchno=sffmatch.matchno且sffbankmatchdetail.bankflowno=sffcommbankflow.bankflowno。 需要核销的流水需要人工对账核销，没有自动任务参与其中，其核销的数据流转情况如图所示： 当月没有核销的银行流水信息（sffcommbankflow）会存在sffunmatchdeallist表中，体现为未达账（银行已收公司未收（刷卡/非刷卡））。","categories":[{"name":"收付费","slug":"收付费","permalink":"http://blog.zsongzhe.site/categories/收付费/"}],"tags":[{"name":"对账","slug":"对账","permalink":"http://blog.zsongzhe.site/tags/对账/"},{"name":"核销","slug":"核销","permalink":"http://blog.zsongzhe.site/tags/核销/"},{"name":"未达","slug":"未达","permalink":"http://blog.zsongzhe.site/tags/未达/"}]},{"title":"集中收款（JZSK）扫码缴费方式完成缴费，部分转保单生成的暂收款怎么退","slug":"集中收款（JZSK）扫码缴费方式完成缴费，部分转保单生成的暂收款怎么退","date":"2020-08-25T03:08:59.000Z","updated":"2020-09-09T16:08:40.435Z","comments":true,"path":"2020/08/25/集中收款（JZSK）扫码缴费方式完成缴费，部分转保单生成的暂收款怎么退/","link":"","permalink":"http://blog.zsongzhe.site/2020/08/25/集中收款（JZSK）扫码缴费方式完成缴费，部分转保单生成的暂收款怎么退/","excerpt":"","text":"三代系统出单，部分未转保单生成的暂收款无法原路退回（扫码支付退款信息查询中无法查到退款信息），也无法通过新增退暂收款进行退暂收款操作，只能在暂收款查询中查出，如果需要原路退回，则先判断暂收款流水号在sfftempcreditinfo.useflag=1001、newsumamt=oldsumamt，然后按照以下步骤进行处理(以平顶山的一个保单举例，修正的时候需要将投保单替换为实际未转保单的投保单)： 12345678910111213--改车险系统的状态:update Jfcdconfirmlog set operateflag='8',operateTime=current where businessno='投保单号';insert into platconfirmlog(businessno,errorMsg,operateTimeForHis,errtype) values('投保单号','',current,'9308');insert into prptopolicyLog(proposalno,policytime,inserttimeforhis,operatetimeforhis) values('投保单号',current,current,current)（有数据则不需修改）--收付费中数据修正--1、删除放弃转保表数据delete from sffgiveupinsurancehis where documentno='TDZA202041040000072220'; --2、重置自动抵扣主表的处理状态标记为初始状态（0），便于从承保（电销）系统获取及时的单证状态update sffautodeductmain set dealstate='0',operatetimeforhis=current where documentno='TDZA202041040000072220'; 非电网销出单,指收款指令流水号以JFCD和XSFF开头的 (JF和SF开头的也可以通过原路退回) 修正完成后，则等自动任务运行，目前的频率不高，需要的时间比较长，可以使用以下语句查询收付费和承保系统的交互报文： 12345select a.* from sffinterfacelog a, sffsubinterfacelog b where a.uuid=b.uuid and b.batchno='未转保的投保单号'order by inserttime desc以上面的未转保单的信息举例:select a.* from sffinterfacelog a, sffsubinterfacelog b where a.uuid=b.uuid and b.batchno='TDZA202041040000072220' order by inserttime desc 结果如下： 如果修正完成后自动任务新获取到的state还是等于3，则说明承保系统的数据修正没有走完或者修正的状态有异常，可以查该投保单在车险系统sffstateoutlog 表中的state是否=2，如果是则再重置收付费的状态（收付费系统方案的最后一句），等待重新获取承保的投保单状态；如果不是，则再次执行承保系统的修正。 如果修正后自动任务新获取到的state=2，但是想查询退款状态的话，则用未转保单的投保单在收付费系统 【保费收款 &gt;&gt; 暂收款管理 &gt;&gt; 扫码支付退款查询】进行查询： 如果查出结果中的退款状态为：退款中，并且操作栏中存在退款查询按钮时 （如上图所示），则可以点击【退款查询】按钮进行退款查询。 最终退款成功的页面截图如下： 常见的承保返回收付费的状态值 及对应所代表的含义 自动任务1-收付费缴费未转保单数据处理 自动任务2-新收付费主动从见费出单系统获取缴费","categories":[{"name":"收付费","slug":"收付费","permalink":"http://blog.zsongzhe.site/categories/收付费/"}],"tags":[{"name":"退暂收款","slug":"退暂收款","permalink":"http://blog.zsongzhe.site/tags/退暂收款/"},{"name":"部分转保单","slug":"部分转保单","permalink":"http://blog.zsongzhe.site/tags/部分转保单/"}]},{"title":"见费缴费，保单已经生成，但是一直没有实收","slug":"见费缴费，保单已经生成，但是一直没有实收","date":"2020-08-24T09:05:17.000Z","updated":"2020-09-09T16:08:40.435Z","comments":true,"path":"2020/08/24/见费缴费，保单已经生成，但是一直没有实收/","link":"","permalink":"http://blog.zsongzhe.site/2020/08/24/见费缴费，保单已经生成，但是一直没有实收/","excerpt":"","text":"PS：见费缴费在此处特指sffininterface.cbcexchangeno存在有效值的情况； 保单号已生成，但是收付费中保单一直无法实收； 这种情况的原因比较多，根据收付费自动任务报错的不同，处理方式有所不同： 使用以下语句在收付费中查出获取见费缴费信息失败的原因： 1select * from sffdatadeallog where documentno = '4104200814900028' order by inserttime desc; 查出的remarks就是失败的原因 根据不同的报错，执行不同的方案： 见费缴费，根据缴费通知单号**从见费出单系统获取缴费信息失败：见费移动支付，总部集中收款的标识为空. sffdatadeallog查询结果见截图： 这种情况是见费系统的缴费信息不完整导致，一般为集中收款平台异常，反馈给见费系统的缴费信息缺失，需要从集中收款平台取到需要的值，修改见费系统的数据： 数据修正注意备份： 12update prpjfwechat set corpact=‘企业方实体账号’，corpentity=‘实体账户所属组织’，corpbank=‘实体账户所属银行’，recchannel=‘收款渠道名称’，vcorpact=‘企业方虚拟账号’，vcorpentity=‘虚拟账号所属组织’，vcorpbank=‘虚拟账户所属银行’，oppact=‘交易方账号’，checkcode=‘对账码’，recorgflag=‘总部集中收款的标识’，flag=‘3’，operatetimeforhis=current where exchangeno=‘缴费通知单号’；--以上数据来自集中收款平台，需要补什么和集中收款平台沟通一下，数据修正注意备份。","categories":[{"name":"收付费","slug":"收付费","permalink":"http://blog.zsongzhe.site/categories/收付费/"}],"tags":[{"name":"自动任务报错","slug":"自动任务报错","permalink":"http://blog.zsongzhe.site/tags/自动任务报错/"},{"name":"无法实收","slug":"无法实收","permalink":"http://blog.zsongzhe.site/tags/无法实收/"},{"name":"见费移动支付","slug":"见费移动支付","permalink":"http://blog.zsongzhe.site/tags/见费移动支付/"},{"name":"总部集中收款的标识为空","slug":"总部集中收款的标识为空","permalink":"http://blog.zsongzhe.site/tags/总部集中收款的标识为空/"}]}],"categories":[{"name":"HEXO","slug":"HEXO","permalink":"http://blog.zsongzhe.site/categories/HEXO/"},{"name":"收付费","slug":"收付费","permalink":"http://blog.zsongzhe.site/categories/收付费/"}],"tags":[{"name":"hexo","slug":"hexo","permalink":"http://blog.zsongzhe.site/tags/hexo/"},{"name":"个人博客","slug":"个人博客","permalink":"http://blog.zsongzhe.site/tags/个人博客/"},{"name":"picgo","slug":"picgo","permalink":"http://blog.zsongzhe.site/tags/picgo/"},{"name":"gitee","slug":"gitee","permalink":"http://blog.zsongzhe.site/tags/gitee/"},{"name":"hueman","slug":"hueman","permalink":"http://blog.zsongzhe.site/tags/hueman/"},{"name":"对账","slug":"对账","permalink":"http://blog.zsongzhe.site/tags/对账/"},{"name":"核销","slug":"核销","permalink":"http://blog.zsongzhe.site/tags/核销/"},{"name":"未达","slug":"未达","permalink":"http://blog.zsongzhe.site/tags/未达/"},{"name":"退暂收款","slug":"退暂收款","permalink":"http://blog.zsongzhe.site/tags/退暂收款/"},{"name":"部分转保单","slug":"部分转保单","permalink":"http://blog.zsongzhe.site/tags/部分转保单/"},{"name":"自动任务报错","slug":"自动任务报错","permalink":"http://blog.zsongzhe.site/tags/自动任务报错/"},{"name":"无法实收","slug":"无法实收","permalink":"http://blog.zsongzhe.site/tags/无法实收/"},{"name":"见费移动支付","slug":"见费移动支付","permalink":"http://blog.zsongzhe.site/tags/见费移动支付/"},{"name":"总部集中收款的标识为空","slug":"总部集中收款的标识为空","permalink":"http://blog.zsongzhe.site/tags/总部集中收款的标识为空/"}]}